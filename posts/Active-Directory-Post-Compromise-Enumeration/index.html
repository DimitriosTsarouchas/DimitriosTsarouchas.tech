<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="theme" content="Chirpy v2.7.2"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="Active Directory - Post-Compromise Enumeration" /><meta name="author" content="Dimitrios Tsarouchas" /><meta property="og:locale" content="en_US" /><meta name="description" content="Active Directory Post-Compromise Enumeration Overview The attacker has compromised a user account and captured its password hash for later use. By using offline cracking tools he managed to crack the password hash and got the password in plain-text. Taking advantage of SMB relay, he got into a machine, dumped the SAM file and collected the hashes that were stored stored in the file. He also managed to create an account in the AD using the mitm6 tool and owned the whole domain." /><meta property="og:description" content="Active Directory Post-Compromise Enumeration Overview The attacker has compromised a user account and captured its password hash for later use. By using offline cracking tools he managed to crack the password hash and got the password in plain-text. Taking advantage of SMB relay, he got into a machine, dumped the SAM file and collected the hashes that were stored stored in the file. He also managed to create an account in the AD using the mitm6 tool and owned the whole domain." /><link rel="canonical" href="https://dimitrios-tsarouchas.tech//posts/Active-Directory-Post-Compromise-Enumeration/" /><meta property="og:url" content="https://dimitrios-tsarouchas.tech//posts/Active-Directory-Post-Compromise-Enumeration/" /><meta property="og:site_name" content="Dimitrios Tsarouchas" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-08-14T02:55:00+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Active Directory - Post-Compromise Enumeration" /><meta name="twitter:site" content="@DimitriosTsaro5" /><meta name="twitter:creator" content="@Dimitrios Tsarouchas" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"Dimitrios Tsarouchas"},"description":"Active Directory Post-Compromise Enumeration Overview The attacker has compromised a user account and captured its password hash for later use. By using offline cracking tools he managed to crack the password hash and got the password in plain-text. Taking advantage of SMB relay, he got into a machine, dumped the SAM file and collected the hashes that were stored stored in the file. He also managed to create an account in the AD using the mitm6 tool and owned the whole domain.","url":"https://dimitrios-tsarouchas.tech//posts/Active-Directory-Post-Compromise-Enumeration/","@type":"BlogPosting","headline":"Active Directory - Post-Compromise Enumeration","dateModified":"2021-11-30T11:37:25+00:00","datePublished":"2021-08-14T02:55:00+01:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://dimitrios-tsarouchas.tech//posts/Active-Directory-Post-Compromise-Enumeration/"},"@context":"https://schema.org"}</script><title>Active Directory - Post-Compromise Enumeration | Dimitrios Tsarouchas</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="preload" href="/assets/css/post.css" as="style"><link rel="stylesheet" href="/assets/css/post.css"><link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" /> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="/assets/js/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/me.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Dimitrios Tsarouchas</a></div><br><div class="site-subtitle font-italic">Cybersecurity and CTFs</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>Home</span> </a><li class="nav-item"> <a href="/tabs/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tabs/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/tabs/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/tabs/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <script src="https://tryhackme.com/badge/44835"></script> <a href="https://github.com/DimitriosTsarouchas" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://linkedin.com/in/dimitrios-tsarouchas" aria-label="linkedin" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-linkedin-in"></i> </a> <a href="https://twitter.com/DimitriosTsaro5" aria-label="twitter" class="order-5" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['dimitristsaroucha','gmail.com'].join('@')" aria-label="email" class="order-6" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-7" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Active Directory - Post-Compromise Enumeration</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Active Directory - Post-Compromise Enumeration</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sat, Aug 14, 2021, 2:55 AM +0100" > Aug 14, 2021 <i class="unloaded">2021-08-14T02:55:00+01:00</i> </span> by <span class="author"> Dimitrios Tsarouchas </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Tue, Nov 30, 2021, 11:37 AM +0000" > Nov 30, 2021 <i class="unloaded">2021-11-30T11:37:25+00:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1823 words">10 min</span></div></div><div class="post-content"><h2 id="active-directory-post-compromise-enumeration-overview">Active Directory Post-Compromise Enumeration Overview</h2><p>The attacker has compromised a user account and captured its password hash for later use. By using offline cracking tools he managed to crack the password hash and got the password in plain-text. Taking advantage of SMB relay, he got into a machine, dumped the SAM file and collected the hashes that were stored stored in the file. He also managed to create an account in the AD using the mitm6 tool and owned the whole domain.</p><p>Next step is the enumeratation of the network in order to see what actions he can do on the domain. Active Directory enumeration can be done by using two tools, “<strong>PowerView</strong>” <a href="#1">1</a> and “<strong>BloodHound</strong>” <a href="#2">2</a>.</p><p>PowerView is a PowerShell typescript that allows the attacker to enumerate the domain controller, domain policy, domain user groups and many more.</p><p>BloodHound allows the attacker to visualise in a graph form what is going on in the domain and where he can find the user that might be logged in, or what is the shortest path to access Domain Admins.</p><h2 id="domain-enumeration-using-powerview">Domain Enumeration using PowerView</h2><p>PowerView needs to be installed and run directly in one of the client machines since the domain enumeration takes place in a virtual environment. In a real-life scenario, an attacker will have access to a Windows shell and will use that shell to load PowerView.</p><p><strong>Step 1: Bypassing PowerShell Execution Policy</strong></p><p>Our first step in the AD enumeration begins with bypassing the PowerShell execution policy, which exists for preventing users from accidentally executing scripts that might cause side effects on a Windows system. To bypass the execution policy we run <code class="language-plaintext highlighter-rouge">powershell –ExecutionPolicy bypass</code>.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/AD/Bypassing.png" alt="Bypassing PowerShell's execution policy" /><em>Bypassing PowerShell’s execution policy</em></p><p><strong>Step 2: Loading PowerView</strong></p><p>We will load PowerView by running <code class="language-plaintext highlighter-rouge">. .\PowerView.ps1</code>.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/AD/Loading_PowerView.png" alt="Loading PowerView" /><em>Loading PowerView</em></p><p><strong>Step 3: Getting information about the domain</strong></p><p>It is time to collect information about the domain by running the <code class="language-plaintext highlighter-rouge">Get-NetDomain</code> command.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/AD/Get_information.png" alt="Get information about the domain" /><em>Get information about the domain</em></p><p>Now we have valuable information about the domain like the forest name(<strong>university.local</strong>) and the domain controller(<strong>DC01.university.local</strong>)</p><p><strong>Step 4: Getting information about domain controllers</strong></p><p>Let’s dig more and get information about the domain controller using the <code class="language-plaintext highlighter-rouge">Get-NetDomainController</code> command.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/AD/info_about_DC.png" alt="Get information about the DC" /><em>Get information about the DC</em></p><p>On our hands we have information about the domain controller, such as its IP address (<strong>192.168.242.139</strong>) and its name (<strong>DC01.university.local</strong>). Some networks have multiple domain controllers, and using this command will provide all that information for the domain controllers, as shown above. If other scanning tools fail to identify the domain controller in the network, the <code class="language-plaintext highlighter-rouge">Get-NetDomainController</code> provides the domain controller’s IP address and that adds extra value in this command.</p><p><strong>Step 5: Getting the domain policy</strong></p><p>Once we got what we need regarding the domain controller we need to learn more about the domain policy by using the <code class="language-plaintext highlighter-rouge">Get-DomainPolicy</code> command.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/AD/info_about_dp.png" alt="Get information about the domain policy" /><em>Get information about the domain policy</em></p><p>This command displays all the different policies in the domain, such as the System Access policy and the Kerberos policy. We go deeper and searching for information about the System Access policy using the <code class="language-plaintext highlighter-rouge">(Get-DomainPolicy)." systemaccess"</code> command.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/AD/info_about_sp.png" alt="Get information about the system’s policies" /><em>Get information about the system’s policies</em></p><p>The execution of this command gives the attacker valuable information about system policy such as the “<strong>Minimum Password Age</strong>”, the “<strong>Maximum Password Age</strong>” and more. The exciting part here is the “<strong>Minimum Password Length</strong>” policy, which in this case it is seven. Why is this valuable to us? The answers is that now we know that the minimum password is seven and we can go ahead, spray a seven-character password across the network, and probably gain access to some user accounts.</p><p><strong>Step 6: Getting information about users</strong></p><p>Let’s move further and grab some information about users in the domain which can be done using the <code class="language-plaintext highlighter-rouge">"Get-NetUser | select samaccountname, lastlogon, description, memberof"</code> command.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/AD/info_about_users.png" alt="Get information about the users" /><em>Get information about the users</em></p><p>Now that we got some information about the users in the domain we will use filters to narrow down the results. The above figure displays all the users in the “<strong>university.local</strong>” domain, using filters like the SAM account name, the last logon, the description and which group the users are members of. The exciting thing here is that in the description of the SQLService account, it is shown that its password is “<strong>Password123@</strong>”, allowing the attacker to compromise that account by just viewing the description.</p><p><strong>Step 7: Getting users’ properties</strong></p><p>Now let’s learn more about user properties, such as when the password was last set by using the <code class="language-plaintext highlighter-rouge">Get-DomainUser -Properties samaccountname,pwdlastset</code> command.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/AD/get_user_prop.png" alt="Get the users' properties" /><em>Get the users’ properties</em></p><p>We got information about the users’ password last set property, which is useful for clarifying whether an account is old or new in the network. For example, the Administrator’s password was last changed on 23th of August, and the new user from the man-in-the-middle attack was changed on the 25th of August.</p><p><strong>Step 8: Getting logon information</strong> In the same manner, the logon count can be obtained using the <code class="language-plaintext highlighter-rouge">Get-DomainUser -Properties samaccountname, logoncount</code> command.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/AD/get_logon_info.png" alt="Get Logon information" /><em>Get Logon information</em></p><p>Using the above command, an attacker can identify whether or not there are honeypot accounts in the network by checking how many times a user has logged in the network. If an account has never logged in before that might be a honeypot account, and the attacker will avoid messing up with this account entirely because it is sitting there in the network on purpose for an attacker to capture it and once he captures it, it will alert the organisation’s systems.</p><p><strong>Step 9: Getting bad password count</strong></p><p>Bad password count for the user accounts on the domain can be obtained using the <code class="language-plaintext highlighter-rouge">Get-DomainUser –Properties samaccountname, badpwdcount</code> command</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/AD/wrong_pass.png" alt="Get information about wrong passwords" /><em>Get information about wrong passwords</em></p><p>It provides valuable information in case an attacker sees, for example, 100 bad passwords for an account, meaning that this account might be under a brute force attack.</p><p><strong>Step 10: Getting all computers in the network</strong></p><p>Let’s check the operating systems that computer systems run on the domain by using the <code class="language-plaintext highlighter-rouge">"Get-DomainComputer | select samaccountname, operatingsystem"</code> command.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/AD/get_computer_info.png" alt="Get information about the computers on the network" /><em>Get information about the computers on the network</em></p><p>Using this command filtered with the SAM account name and the operating system, an attacker can see the number of computers as well as if this computer is a server or a workstation on that network.</p><p><strong>Step 11: Getting group members</strong></p><p>Getting group members that are Domain Admins can be done by using the <code class="language-plaintext highlighter-rouge">Get-DomainGroupMember 'Domain Admins'</code> command.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/AD/group_members.png" alt="Get the group members" /><em>Get the group members</em></p><p>Using this command, the attacker can identify who are domain administrators in that domain. According to the figure above, “<strong>SQLService</strong>”, “<strong>Jack Smith</strong>” and “<strong>Administrator</strong>” belong to the Domain Admins group.</p><p><strong>Step 12: Getting Group Policies</strong></p><p>Getting group policies on the domain can be done by using the <code class="language-plaintext highlighter-rouge">Get-DomainGPO | select displayname, whenchanged</code> command.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/AD/group_policies.png" alt="Get information about the group policies" /><em>Get information about the group policies</em></p><p>This command is useful to an attacker because it shows up all the group policies that have been specified in the domain. According to the above figure, the attacker gets information that the Windows Defender has been disabled, which will help him gain time from trying to bypass it.</p><p><strong>Step 13: Getting file shares</strong></p><p>File shares on the domain can be obtained by using the <code class="language-plaintext highlighter-rouge">Invoke-ShareFinder</code> command.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/AD/file_shares.png" alt="Get information about file shares on the network" /><em>Get information about file shares on the network</em></p><p>Using the <code class="language-plaintext highlighter-rouge">Invoke-ShareFinder</code> command, we found out all the SMB shares in the network, and we can see what files are being shared and where they are being shared. For example, we found out the “<strong>MScShare</strong>” folder that lives on the domain controller as well as two “<strong>Share</strong>” folders that live on the users’ machines.</p><h2 id="domain-enumeration-using-bloodhound">Domain Enumeration using BloodHound</h2><p>Once an attacker is in a machine in a network, BloodHound will download the data of Active Directory and visualise that data in a graph. It gives the attacker much information about the network very quickly. Otherwise, it would be very timing consuming to figure out all the intricate paths that exist on the network, like to get into a domain admin.</p><p><strong>Step 1: Collect data using SharpHound</strong></p><p>We will utilise SharpHound on the “<strong>dtsarouchas</strong>” machine to collect data from the domain that will then analyse with BloodHound. In order to do that we use the <code class="language-plaintext highlighter-rouge">Invoke-BloodHound –CollectionMethod All –Domain university.local –ZipFilename university.zip</code> command.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/AD/SharpHound.png" alt="Collect domain data via SharpHound" /><em>Collect domain data via SharpHound</em></p><p><strong>Step 2: Uploading data to BloodHound</strong></p><p>After we get the data in the “<strong>university.zip</strong>” file, we then upload it to the BloodHound using the upload icon in the right-hand side on the BloodHound’s interface.</p><p><strong>Step 3: Database info</strong></p><p>After uploading the zip file in the BloodHound, the information about the database is available to us by clicking the hamburger icon on the left-hand side of the BloodHound’s interface. There one can see the number of users, computers, groups, active sessions, ACLs and relationships that exist on the network.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/AD/database_information.png" alt="Get database information" /><em>Get database information</em></p><p><strong>Step 4: Pre-built queries</strong></p><p>BloodHound provides a list of pre-built queries that an attacker can make use of, as shown below.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/AD/Pre-Built.png" alt="Pre-Built Analytics Queries" /><em>Pre-Built Analytics Queries</em></p><p><strong>Step 5: Finding all Domain Admins</strong></p><p>According to the image below, “<strong>ADMINISTRATOR@UNIVERSITY.LOCAL</strong>”, “<strong>JSMITH@UNIVERSITY.LOCAL</strong>” and “<strong>SQLSERVICE@UNIVERSITY.LOCAL</strong>” are Domain Admins on the “<strong>university.local</strong>” domain. That way we know all the Domain Admins that exist on the domain.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/AD/Find_all.png" alt="Find all Domain Admins" /><em>Find all Domain Admins</em></p><p><strong>Step 6: Finding the shortest path to Domain Admins</strong></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/AD/shortest_path.png" alt="Find the shortest path to Domain Admins" /><em>Find the shortest path to Domain Admins</em></p><p>As shown in the figure above, “<strong>DTSAROUCHAS@UNIVERSITY.LOCAL</strong>” user is an administrator on the “<strong>MSCADMIN.UNIVERSITY.LOCAL</strong>” computer, which in turn has a session to “<strong>ADMINISTRATOR@UNIVERSITY.LOCAL</strong>” account. It gives to the attacker the information that he can impersonate that user with the Token Impersonation attack, which will be covered on a later article. The attacker’s goal is to target machines where a Domain Admin is logged in. For example, if the attacker targets the “MSCADMIN” machine and owns it, he can own the Administrator account, and subsequently, he is the Domain Admin, and that is the shortest path for him to get on that level of access.</p><p><strong>Step 6: Finding the shortest path to Domain Admins</strong></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/AD/Kerberoastable_users.png" alt="Find paths for Kerberoastable users" /><em>Find paths for Kerberoastable users</em></p><p>According to the above figure, the “<strong>SQLSERVICE@UNIVERISTY.LOCAL</strong>” is part of the Domain Admins, “<strong>DTSAROUCHAS (MSCADMIN.UNIVERSITY.LOCAL)</strong>” and “<strong>JDOE (MSCSTUDENT.UNIVERSITY.LOCAL)</strong>” users have access to the Domain Admins as well.</p><p><strong>Step 7: Finding high-targeted values</strong></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/AD/high-targeted_accounts.png" alt="Find high-targeted accounts" /><em>Find high-targeted accounts</em></p><p>According to the above figure, “<strong>Administrators</strong>”, “<strong>Enterprise Admins</strong>”, and “<strong>Domain Admins</strong>” are high-level targets. “<strong>DTSAROUCHAS@UNIVERSITY.LOCAL</strong>” is an administrator on the “<strong>MSCADMIN.UNIVERSITY.LOCAL</strong>” computer machine, which has a session with “<strong>ADMINISTRATOR@UNIVERSITY.LOCAL</strong>”, who is part of the “<strong>ADMINISTRATORS@UNIVERSITY.LOCAL</strong>” group, which is part of the “<strong>DOMAN ADMINS@UNIVERSITY.LOCAL</strong>” group, which is part of the “<strong>ENTERPRISE ADMINS@UNIVERSITY.LOCAL</strong>” group.</p><p>Later posts will cover attacks that require some credentials to be already known, meaning that a domain must have already been compromised for these attacks to follow. In order for these attacks to be effective, the attacker must have a username and password in his possession.</p><p>The attacks that will be covered in later posts are the following:</p><ul><li>Pass-the-Hash (PtH)<li>Pass-the-Password (PtP)<li>Token Impersonation<li>Kerberoasting<li>GPP/cpassword Attack<li>Dumping the Local Security Authority<li>Golden Ticket Attack</ul><p>Stay tuned!!</p><p><br /></p><p><strong>References</strong></p><p>[1]<a name="1"></a> <a href="https://github.com/PowerShellMafia/PowerSploit/blob/master/Recon/PowerView.ps1" target="_blank">PowerSploit Tool.</a></p><p>[2]<a name="2"></a> <a href="https://github.com/BloodHoundAD/BloodHound" target="_blank">BloodHound Tool.</a></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/windows/'>Windows</a>, <a href='/categories/active-directory/'>Active Directory</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/active-directory/" class="post-tag no-text-decoration" >active directory</a> <a href="/tags/windows/" class="post-tag no-text-decoration" >windows</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Active Directory - Post-Compromise Enumeration - Dimitrios Tsarouchas&url=https://dimitrios-tsarouchas.tech//posts/Active-Directory-Post-Compromise-Enumeration/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Active Directory - Post-Compromise Enumeration - Dimitrios Tsarouchas&u=https://dimitrios-tsarouchas.tech//posts/Active-Directory-Post-Compromise-Enumeration/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Active Directory - Post-Compromise Enumeration - Dimitrios Tsarouchas&url=https://dimitrios-tsarouchas.tech//posts/Active-Directory-Post-Compromise-Enumeration/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Tmux/">Tmux</a><li><a href="/posts/Active-Directory-SetUp/">Active Directory - Domain Controller Setup</a><li><a href="/posts/Goals-of-Security/">Goals of Security</a><li><a href="/posts/Threat-Actors/">Threat Actors</a><li><a href="/posts/Active-Directory-Post-Compromise-Enumeration/">Active Directory - Post-Compromise Enumeration</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/active-directory/">active directory</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/ctf/">ctf</a> <a class="post-tag" href="/tags/tryhackme/">tryhackme</a> <a class="post-tag" href="/tags/information-security/">information security</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/android/">android</a> <a class="post-tag" href="/tags/apts/">APTs</a> <a class="post-tag" href="/tags/cia-triad/">cia triad</a> <a class="post-tag" href="/tags/cve-2019-14287/">CVE-2019-14287</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Active-Directory-Authentication-Mechanisms/"><div class="card-body"> <span class="timeago small" > Aug 7, 2021 <i class="unloaded">2021-08-07T01:55:00+01:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Active Directory Authenitcation Mechanisms</h3><div class="text-muted small"><p> Windows New Technology LAN Manager vs Kerberos Authentication protocols Introduction Windows Authentication verifies that the information provided in the operating system comes from a trusted sourc...</p></div></div></a></div><div class="card"> <a href="/posts/Active-Directory-LLMNR-Poisoning/"><div class="card-body"> <span class="timeago small" > Aug 7, 2021 <i class="unloaded">2021-08-07T02:55:00+01:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Active Directory - LLMNR and NBT-NS Poisoning</h3><div class="text-muted small"><p> Attacking Active Directory Active Directory plays an essential role in a corporate domain that makes it quite attractive to attackers. The service itself does not have to be the target as it can se...</p></div></div></a></div><div class="card"> <a href="/posts/Active-Directory-SMB-Relay-Attack/"><div class="card-body"> <span class="timeago small" > Aug 10, 2021 <i class="unloaded">2021-08-10T02:55:00+01:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Attacking Active Directory - SMB Relay Attack</h3><div class="text-muted small"><p> Server Message Block Relay Attack Overview In an SMB Relay attack, an attacker instead of cracking the captured hashes offline relays those hashes to another machine on the same network. For this ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Active-Directory-IPv6-Attack/" class="btn btn-outline-primary"><p>Attacking Active Directory - IPv6 Attack</p></a> <a href="/posts/Active-Directory-Pass-the-Hash/" class="btn btn-outline-primary"><p>Attacking Active Directory - Pass-the-Hash / Pass-the-Password Attacks</p></a></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('.post-content img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/DimitriosTsaro5">Dimitrios Tsarouchas</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/active-directory/">active directory</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/ctf/">ctf</a> <a class="post-tag" href="/tags/tryhackme/">tryhackme</a> <a class="post-tag" href="/tags/information-security/">information security</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/android/">android</a> <a class="post-tag" href="/tags/apts/">APTs</a> <a class="post-tag" href="/tags/cia-triad/">cia triad</a> <a class="post-tag" href="/tags/cve-2019-14287/">CVE 2019 14287</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://dimitrios-tsarouchas.tech/{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script>
