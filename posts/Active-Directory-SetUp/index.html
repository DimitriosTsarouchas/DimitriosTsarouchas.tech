<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="theme" content="Chirpy v2.7.2"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="Active Directory - Domain Controller Setup" /><meta name="author" content="Dimitrios Tsarouchas" /><meta property="og:locale" content="en_US" /><meta name="description" content="Setting up the Domain Controller" /><meta property="og:description" content="Setting up the Domain Controller" /><link rel="canonical" href="https://dimitrios-tsarouchas.tech//posts/Active-Directory-SetUp/" /><meta property="og:url" content="https://dimitrios-tsarouchas.tech//posts/Active-Directory-SetUp/" /><meta property="og:site_name" content="Dimitrios Tsarouchas" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-12-27T01:55:00+00:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Active Directory - Domain Controller Setup" /><meta name="twitter:site" content="@DimitriosTsaro5" /><meta name="twitter:creator" content="@Dimitrios Tsarouchas" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"Dimitrios Tsarouchas"},"description":"Setting up the Domain Controller","url":"https://dimitrios-tsarouchas.tech//posts/Active-Directory-SetUp/","@type":"BlogPosting","headline":"Active Directory - Domain Controller Setup","dateModified":"2021-12-28T21:00:34+00:00","datePublished":"2021-12-27T01:55:00+00:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://dimitrios-tsarouchas.tech//posts/Active-Directory-SetUp/"},"@context":"https://schema.org"}</script><title>Active Directory - Domain Controller Setup | Dimitrios Tsarouchas</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="preload" href="/assets/css/post.css" as="style"><link rel="stylesheet" href="/assets/css/post.css"><link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" /> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="/assets/js/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/me.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Dimitrios Tsarouchas</a></div><br><div class="site-subtitle font-italic">Cybersecurity and CTFs</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>Home</span> </a><li class="nav-item"> <a href="/tabs/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tabs/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/tabs/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/tabs/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <script src="https://tryhackme.com/badge/44835"></script> <a href="https://github.com/DimitriosTsarouchas" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://linkedin.com/in/dimitrios-tsarouchas" aria-label="linkedin" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-linkedin-in"></i> </a> <a href="https://twitter.com/DimitriosTsaro5" aria-label="twitter" class="order-5" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['dimitristsaroucha','gmail.com'].join('@')" aria-label="email" class="order-6" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-7" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Active Directory - Domain Controller Setup</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Active Directory - Domain Controller Setup</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Mon, Dec 27, 2021, 1:55 AM +0000" > Dec 27, 2021 <i class="unloaded">2021-12-27T01:55:00+00:00</i> </span> by <span class="author"> Dimitrios Tsarouchas </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Tue, Dec 28, 2021, 9:00 PM +0000" > Dec 28, 2021 <i class="unloaded">2021-12-28T21:00:34+00:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1382 words">7 min</span></div></div><div class="post-content"><h2 id="setting-up-the-domain-controller">Setting up the Domain Controller</h2><p>Once we have downloaded the required ISO files for the <a href="https://www.microsoft.com/en-gb/evalcenter/evaluate-windows-server-2019" target="_blank">Windows Server 2019</a> and <a href="https://www.microsoft.com/en-gb/evalcenter/evaluate-windows-10-enterprise" target="_blank">Windows 10 Enterprise</a>, and have installed them in the virtual machine of our choice, we are ready to set up the Domain Controller.</p><p><strong>Note</strong>: First, when installing both iso files remember to remove entirely the <strong>Floppy</strong> device from the <strong>Hardawre</strong> tab on the <strong>VM Settings</strong>. Forgetting to do that step, the virtual machine will try to install the “<strong>autoinst.flp</strong>” file which will ask for a key and it won’t let us proceed to the installation! Secondly, remember to use <strong>NAT:Used to share host’s IP address</strong> (in VMWare) as your Network connection. Thirdly, during Windows Server setup we will select <strong>“Windows Server 2019 Standard Evaluation (Desktop Experience)”</strong> as our operating system.</p><p>That’s it let’s jump in to setting up the DC!</p><p>Once everything is set up and you enter your Windows Server desktop the first thing we need to do is to rename the PC. Click on the start button and type “<strong>Computer</strong>” this will show up the “<strong>View your PC name</strong>” click on it and it will send you to the <strong>About</strong> section of the PC settings. <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/ADSetup/1.Change_AD_Name.png" alt="Change_AD_Name" /> Then click on the “<strong>Rename this PC</strong>” button. <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/ADSetup/2.Rename_PC_Name.png" alt="Rename_PC_Name" /> I am gonna rename my PC as “<strong>TEST-DC</strong>” where the “<strong>DC</strong>” indicates that this is a domain controller. You can use whatever name you want your DC to be named, but keep in mind that the name should resemble a domain controller. After renaming your PC, click <strong>Next</strong> and restart your pc by clicking “<strong>Restart Now</strong>” in the next window that will pop up. Once the PC is restarted, sign in to it, and once you do that you will be ready to install the Domain Controller from the <strong>Server Manager Dashboard</strong>. <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/ADSetup/3.Server_management_Dashboard.png" alt="Server_management_Dashboard" /></p><p>The next step is to click on the top right-hand side in the menu <code class="language-plaintext highlighter-rouge">Manage -&gt; Add Roles and Features</code>.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/ADSetup/4.Add_RolesAndFeatures.png" alt="Add_RolesAndFeatures" /> Click <code class="language-plaintext highlighter-rouge">Next</code>. <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/ADSetup/5.AddRolesAndFeaturesWizard.png" alt="AddRolesAndFeaturesWizard" /> Select “<strong>Role-based or feature-based installation</strong>” and click <code class="language-plaintext highlighter-rouge">Next</code>. <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/ADSetup/6.RoleBasedAndFeatureBasedInstallation.png" alt="RoleBasedAndFeatureBasedInstallation" /> “<strong>Select a server from a server pool</strong>” and click <code class="language-plaintext highlighter-rouge">Next</code>. <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/ADSetup/7.SelectSerrverFromTheServerPool.png" alt="SelectSerrverFromTheServerPool" /> On selecting server roles we will double click on the “<strong>Active Directory Domain Services</strong>” and in the new “<strong>Add Roles and Features Wizard</strong>” window, we hit <code class="language-plaintext highlighter-rouge">Add Features</code>. <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/ADSetup/8.ADDSAddFeatures.png" alt="ADDSAddFeatures" /></p><p>Click <code class="language-plaintext highlighter-rouge">Next</code>.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/ADSetup/9.SekectFeatures_Next.png" alt="SekectFeatures_Next" /></p><p>Click <code class="language-plaintext highlighter-rouge">Next</code>.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/ADSetup/10.ADDS_Next.png" alt="ADDS_Next" /></p><p>Click <code class="language-plaintext highlighter-rouge">Install</code>.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/ADSetup/11.Confirmation_install.png" alt="Confirmation_install" /></p><p>After the installation is completed click <code class="language-plaintext highlighter-rouge">Close</code>.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/ADSetup/12.Installation_Close.png" alt="Installation_Close.png" /></p><p>You will notice on the Dashboard that there is an alert button under the Flag icon, click on the flag, and then click on “<strong>Promote this server to a domain controller</strong>”.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/ADSetup/13.Promote_this_server_to_A-DC.png" alt="Promote_this_server_to_A-DC" /></p><p>Then we will select “<strong>Add a new forest</strong>” and will give a Root domain, again I will name my domain as “<strong>TESTING.local</strong>”, you can give whatever name you’d like and remember to include the “<strong>.local</strong>” after the name, and click <code class="language-plaintext highlighter-rouge">Next</code>.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/ADSetup/14.Adding_A_New_forest.png" alt="Adding_A_New_forest" /></p><p>Then we will specify a password for our Domain Services Restore Mode (DSRM), and click <code class="language-plaintext highlighter-rouge">Next</code>.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/ADSetup/15.DC_Options.png" alt="DC_Options" /></p><p>Click <code class="language-plaintext highlighter-rouge">Next</code>.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/ADSetup/16.DNS_OPtions.png" alt="DNS_OPtions" /></p><p>Next, you will see your domain name is automatically populated into the <strong>NetBIOS domain name</strong> input field. Click <code class="language-plaintext highlighter-rouge">Next</code>.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/ADSetup/17.Additoinal_Options.png" alt="Additoinal_Options" /></p><p>Click <code class="language-plaintext highlighter-rouge">Next</code> on the Paths.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/ADSetup/18.Paths.png" alt="Paths" /></p><p>Click <code class="language-plaintext highlighter-rouge">Next</code> on the Review Options.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/ADSetup/19.Reveiw_Options_Next.png" alt="Reveiw_Options_Next" /></p><p>Click <code class="language-plaintext highlighter-rouge">Install</code> and once the installation is done the PC will automatically reboot.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/ADSetup/20.Install.png" alt="Install" /></p><p>Once the machine is rebooted you will notice it will have a user of <strong>TESTING\Administrator</strong> (or whatever name you have chosen for your domain name), which means that we’re logging in to the domain <strong>TESTING</strong> as the <strong>Administrator</strong>, type your password, and you will be logged in as the administrator of your domain.</p><h2 id="configure-the-domain-controller">Configure the Domain Controller</h2><p>Okay, now let’s configure our domain controller. We’re gonna configure some domain policies, create some users and take a general look at Active Directory.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/ADSetup/ConfigureDC/1.LoginToTheDomainAsAdmin.png" alt="LoginToTheDomainAsAdmin" /></p><p>From the top menu select <code class="language-plaintext highlighter-rouge">Tools -&gt; Active Directory Users and Computers</code>.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/ADSetup/ConfigureDC/2.AD_UsersAndComputers.png" alt="AD_UsersAndComputers" /></p><p>Expanding the <strong>TESTING.local</strong> we can see that there are some <strong>Organisational Units</strong> in it (Builtin, Computers, Domain Controllers, ForeignSecurityPrincipals, Managed Service Accounts and Users).</p><p>Create a new OU (<code class="language-plaintext highlighter-rouge">right-click -&gt; New -&gt;Organizational Unit</code>) and name it “<strong>Group</strong>”. We will move all the users that belong to the <strong>Users OU</strong> and have the type of “<strong>Security Group</strong>” into the newly created <strong>Group OU</strong> as shown below.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/ADSetup/ConfigureDC/3.NewOU.png" alt="NewOU" /> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/ADSetup/ConfigureDC/4.MOveSecurityGroups.png" alt="MoveSecurityGroups" /></p><p>Now we’ve got a nice and clean Users OU area. Whenever you see a down error next to a user (see Guest user), that means that the account has been disabled.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/ADSetup/ConfigureDC/5.UsersOU.png" alt="UsersOU" /></p><p>In the next figure, we can see that the <strong>Administrator</strong> user is a <strong>Member of Domain Admins</strong>, which means that they are administrators and if you are a <strong>Domain User</strong> that means that you’re able to log in to the domains. So we will create a couple of domain users and domain admin as well.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/ADSetup/ConfigureDC/6.AdminProps.png" alt="AdminProps" /></p><p>In the <strong>Active Directory Users and Computers Users OU</strong> right-click <code class="language-plaintext highlighter-rouge">New -&gt; User</code> and create our first user, John Doe. We need to pick our name convention which in our case will be the first initial followed by last name like this: “<strong>jdoe</strong>”.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/ADSetup/ConfigureDC/7.CreatingAUser.png" alt="CreatingAUser" /></p><p>Then we enter John’s password.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/ADSetup/ConfigureDC/8.Userspassword.png" alt="Userspassword" /></p><p>Next, we will create a user, Mary Doe, who will be an administrator, and we’ll do that by right-clicking on the Administrator user account and selecting “<strong>Copy</strong>”. Mary will inherit all the Administrator’s properties.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/ADSetup/ConfigureDC/9.CopyADomainAdmin.png" alt="CopyADomainAdmin" /></p><p>We have created one more regular domain user, Jack Daniels, by copying John Doe’s user object. As we can see below, Jack Daniels is a member of Domain Users because we copied that property from John Doe. If we look at Mary Doe, we can see that she is a member of all of the same groups as the Administrator is because we copied that from the Administrator. Additionally, we have created an additional account called SQLService.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/ADSetup/ConfigureDC/10.DifferenceBetrweenDA_And_DU.png" alt="DifferenceBetrweenDA_And_DU" /></p><p>Now, we will create a shared folder by going to <code class="language-plaintext highlighter-rouge">Files and Storage Services -&gt; Shares</code>, clicking on the “<strong>TASKS</strong>” dropdown and selecting “<strong>New Share</strong>”.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/ADSetup/ConfigureDC/11.New_Shares.png" alt="New_Shares" /></p><p>Select “<strong>SMB Share - Quick</strong>” and click <code class="language-plaintext highlighter-rouge">Next</code>.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/ADSetup/ConfigureDC/12.SMB_Share_Quick.png" alt="SMB_Share_Quick" /></p><p>Click <code class="language-plaintext highlighter-rouge">Next</code>.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/ADSetup/ConfigureDC/13.OathforShare.png" alt="OathforShare" /></p><p>As a “<strong>Share name</strong>” I will give “<strong>SharedFolder</strong>”, feel free to name your shared folder whatever name you want, and click <code class="language-plaintext highlighter-rouge">Next</code>.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/ADSetup/ConfigureDC/14NameSharedFolder.png" alt="NameSharedFolder" /></p><p>Click <code class="language-plaintext highlighter-rouge">Create</code> and then <code class="language-plaintext highlighter-rouge">Close</code>.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/ADSetup/ConfigureDC/15.CreateShare.png" alt="CreateShare" /></p><p>So, now we have created a shared folder with the local path “<strong>C:\Shares\SharedFolder</strong>”.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/ADSetup/ConfigureDC/16.ShareFolderCreated.png" alt="ShareFolderCreated" /></p><h4 id="optional">Optional</h4><p>Optionally, we will set a Service Principal Name for our SQLService account.</p><p>Run a cmd as administrator and type the following commands depicted below.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/ADSetup/ConfigureDC/17.SetSPN.png" alt="SetSPN" /></p><p>In order to check that this SPN has been set we type <code class="language-plaintext highlighter-rouge">setspn -T TESTING.local -Q */*</code> and down at the bottom we can see that the SQLService has been set.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/ADSetup/ConfigureDC/18.CheckingSPNSetUp.png" alt="CheckingSPNSetUp" /></p><h2 id="configure-a-domain-user-machine">Configure a Domain User Machine</h2><p>On our user’s machine, we create a shared folder that will be shared with public networks. Next, we need to join John’s pc to the TESTING domain.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/ADSetup/ConfigureUser/1.Enablesharing.png" alt="Enablesharing" /></p><p>First, we need to go on our domain controller and grab its IP address by firing up a cmd and typing <code class="language-plaintext highlighter-rouge">ipconfig</code>. We can see in my DC the IP address is <code class="language-plaintext highlighter-rouge">192.168.144.130</code>, we copy it and then we move tou John’s machine where we will use this IP address as John’s DNS.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/ADSetup/ConfigureUser/2.ADDCIpaddress.png" alt="ADDCIpaddress" /></p><p>Go to <code class="language-plaintext highlighter-rouge">Network and Internet Settings -&gt; Change adapter options -&gt; right-click on Ethernet0 -&gt; Properties -&gt; Internet Protocol Version 4 (TCP/IPv4) Properties</code>, select “<strong>Use the following DNS server address</strong>” and in “<strong>Preferred DNS server</strong>” paste the DC’s IP address (in my occasion is 192.168.144.130).</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/ADSetup/ConfigureUser/3.SettingDNStheDC.png" alt="SettingDNStheDC" /></p><p>Next, click on the start button, type “domain”, select “<strong>Access work or school</strong>”, click “<strong>+ Connect</strong>” and on the “<strong>Set up a work or school account</strong>” window click the “<strong>Join this device to a local Active Directory domain</strong>”.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/ADSetup/ConfigureUser/4.AccessWorkOrSchool.png" alt="AccessWorkOrSchool" /></p><p>Since we’re joining the TESTING domain, under “<strong>Domain name</strong>” we will type “<strong>TESTING.local</strong>”, “<strong>Skip</strong>” the next step and restart the PC.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/ADSetup/ConfigureUser/5.JoiningtheDomain.png" alt="JoiningtheDomain" /></p><p>We join as <strong>Administrator</strong> with our Admin password we have set in the begining.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/ADSetup/ConfigureUser/6.JoiningasAdmin.png" alt="JoiningasAdmin" /> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/ADSetup/ConfigureUser/7Skip.png" alt="7Skip" /></p><p>Once the PC reboots we will join to the doamin as John using his logon name “<strong>jdoe</strong>”, it might take a little time to get everything ready.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/ADSetup/ConfigureUser/8.signingtothedomainasJohn.png" alt="signingtothedomainasJohn" /></p><p>Once everything is ready, we can see that we have successfully logged in the domain as John Doe.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/ADSetup/ConfigureUser/9.loggedinasJdoe.png" alt="loggedinasJdoe" /></p><p>We will now sign in as Administrator using “<strong>testing\administrator</strong>” and the administrator’s password, and we will enable John Doe to be a local administrator on this PC.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/ADSetup/ConfigureUser/10.loginasadmin.png" alt="loginasadmin" /></p><p>Right-click on the start button nad select <code class="language-plaintext highlighter-rouge">Computer Management -&gt; Local Users and Groups -&gt; Groups -&gt; Administrators -&gt; Add...</code>, enter the object name “<strong>jdoe</strong>” and click “<strong>Check Names</strong>”, “<strong>OK</strong>” and “<strong>Apply</strong>”.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/ADSetup/ConfigureUser/11.addingJdoeinthedomain.png" alt="addingJdoeinthedomain" /></p><p>Now we can see that John’s PC has been added to the “<strong>Computers</strong>” OU in Active Directory Users and Computers, and we have successfully joined John Doe to the TESTING.local domain.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/ADSetup/ConfigureUser/12.JohnPCjoinedinthisdomain.png" alt="JohnPCjoinedinthisdomain" /></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/windows/'>Windows</a>, <a href='/categories/active-directory/'>Active Directory</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/active-directory/" class="post-tag no-text-decoration" >active directory</a> <a href="/tags/windows/" class="post-tag no-text-decoration" >windows</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Active Directory - Domain Controller Setup - Dimitrios Tsarouchas&url=https://dimitrios-tsarouchas.tech//posts/Active-Directory-SetUp/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Active Directory - Domain Controller Setup - Dimitrios Tsarouchas&u=https://dimitrios-tsarouchas.tech//posts/Active-Directory-SetUp/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Active Directory - Domain Controller Setup - Dimitrios Tsarouchas&url=https://dimitrios-tsarouchas.tech//posts/Active-Directory-SetUp/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Tmux/">Tmux</a><li><a href="/posts/Active-Directory-SetUp/">Active Directory - Domain Controller Setup</a><li><a href="/posts/Goals-of-Security/">Goals of Security</a><li><a href="/posts/Threat-Actors/">Threat Actors</a><li><a href="/posts/Active-Directory-Post-Compromise-Enumeration/">Active Directory - Post-Compromise Enumeration</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/active-directory/">active directory</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/ctf/">ctf</a> <a class="post-tag" href="/tags/tryhackme/">tryhackme</a> <a class="post-tag" href="/tags/information-security/">information security</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/android/">android</a> <a class="post-tag" href="/tags/apts/">APTs</a> <a class="post-tag" href="/tags/cia-triad/">cia triad</a> <a class="post-tag" href="/tags/cve-2019-14287/">CVE-2019-14287</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Active-Directory-Authentication-Mechanisms/"><div class="card-body"> <span class="timeago small" > Aug 7, 2021 <i class="unloaded">2021-08-07T01:55:00+01:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Active Directory Authenitcation Mechanisms</h3><div class="text-muted small"><p> Windows New Technology LAN Manager vs Kerberos Authentication protocols Introduction Windows Authentication verifies that the information provided in the operating system comes from a trusted sourc...</p></div></div></a></div><div class="card"> <a href="/posts/Active-Directory-LLMNR-Poisoning/"><div class="card-body"> <span class="timeago small" > Aug 7, 2021 <i class="unloaded">2021-08-07T02:55:00+01:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Active Directory - LLMNR and NBT-NS Poisoning</h3><div class="text-muted small"><p> Attacking Active Directory Active Directory plays an essential role in a corporate domain that makes it quite attractive to attackers. The service itself does not have to be the target as it can se...</p></div></div></a></div><div class="card"> <a href="/posts/Active-Directory-SMB-Relay-Attack/"><div class="card-body"> <span class="timeago small" > Aug 10, 2021 <i class="unloaded">2021-08-10T02:55:00+01:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Attacking Active Directory - SMB Relay Attack</h3><div class="text-muted small"><p> Server Message Block Relay Attack Overview In an SMB Relay attack, an attacker instead of cracking the captured hashes offline relays those hashes to another machine on the same network. For this ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Hacking-An-Android-Device/" class="btn btn-outline-primary"><p>Hacking An Android Device</p></a> <span class="btn btn-outline-primary disabled"><p>-</p></span></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('.post-content img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/DimitriosTsaro5">Dimitrios Tsarouchas</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/active-directory/">active directory</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/ctf/">ctf</a> <a class="post-tag" href="/tags/tryhackme/">tryhackme</a> <a class="post-tag" href="/tags/information-security/">information security</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/android/">android</a> <a class="post-tag" href="/tags/apts/">APTs</a> <a class="post-tag" href="/tags/cia-triad/">cia triad</a> <a class="post-tag" href="/tags/cve-2019-14287/">CVE 2019 14287</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://dimitrios-tsarouchas.tech/{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script>
