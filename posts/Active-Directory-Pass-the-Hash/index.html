<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="theme" content="Chirpy v2.7.2"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="Attacking Active Directory - Pass-the-Hash / Pass-the-Password Attacks" /><meta name="author" content="Dimitrios Tsarouchas" /><meta property="og:locale" content="en_US" /><meta name="description" content="Pass-the-Hash Attack Overview Pass-the-Hash (PtH) belongs to the family of Credential Theft and Reuse attacks, which takes advantage of the authentication mechanisms that maintain copies of the credentials on a system." /><meta property="og:description" content="Pass-the-Hash Attack Overview Pass-the-Hash (PtH) belongs to the family of Credential Theft and Reuse attacks, which takes advantage of the authentication mechanisms that maintain copies of the credentials on a system." /><link rel="canonical" href="https://dimitrios-tsarouchas.tech//posts/Active-Directory-Pass-the-Hash/" /><meta property="og:url" content="https://dimitrios-tsarouchas.tech//posts/Active-Directory-Pass-the-Hash/" /><meta property="og:site_name" content="Dimitrios Tsarouchas" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-08-15T02:55:00+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Attacking Active Directory - Pass-the-Hash / Pass-the-Password Attacks" /><meta name="twitter:site" content="@DimitriosTsaro5" /><meta name="twitter:creator" content="@Dimitrios Tsarouchas" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"Dimitrios Tsarouchas"},"description":"Pass-the-Hash Attack Overview Pass-the-Hash (PtH) belongs to the family of Credential Theft and Reuse attacks, which takes advantage of the authentication mechanisms that maintain copies of the credentials on a system.","url":"https://dimitrios-tsarouchas.tech//posts/Active-Directory-Pass-the-Hash/","@type":"BlogPosting","headline":"Attacking Active Directory - Pass-the-Hash / Pass-the-Password Attacks","dateModified":"2021-08-15T02:55:00+01:00","datePublished":"2021-08-15T02:55:00+01:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://dimitrios-tsarouchas.tech//posts/Active-Directory-Pass-the-Hash/"},"@context":"https://schema.org"}</script><title>Attacking Active Directory - Pass-the-Hash / Pass-the-Password Attacks | Dimitrios Tsarouchas</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="preload" href="/assets/css/post.css" as="style"><link rel="stylesheet" href="/assets/css/post.css"><link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" /> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="/assets/js/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/me.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Dimitrios Tsarouchas</a></div><br><div class="site-subtitle font-italic">Cybersecurity and CTFs</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>Home</span> </a><li class="nav-item"> <a href="/tabs/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tabs/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/tabs/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/tabs/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <script src="https://tryhackme.com/badge/44835"></script> <a href="https://github.com/DimitriosTsarouchas" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://linkedin.com/in/dimitrios-tsarouchas" aria-label="linkedin" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-linkedin-in"></i> </a> <a href="https://twitter.com/DimitriosTsaro5" aria-label="twitter" class="order-5" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['dimitristsaroucha','gmail.com'].join('@')" aria-label="email" class="order-6" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-7" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Attacking Active Directory - Pass-the-Hash / Pass-the-Password Attacks</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Attacking Active Directory - Pass-the-Hash / Pass-the-Password Attacks</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sun, Aug 15, 2021, 2:55 AM +0100" > Aug 15, 2021 <i class="unloaded">2021-08-15T02:55:00+01:00</i> </span> by <span class="author"> Dimitrios Tsarouchas </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1600 words">8 min</span></div></div><div class="post-content"><h2 id="pass-the-hash-attack-overview">Pass-the-Hash Attack Overview</h2><p><strong>Pass-the-Hash (PtH)</strong> belongs to the family of Credential Theft and Reuse attacks, which takes advantage of the authentication mechanisms that maintain copies of the credentials on a system.</p><p>A copy of credentials can be used on behalf of the users to access certain services and applications. Single Sign-On (SSO) is a type of such an authentication mechanism.</p><p>Organisations running an Active Directory service will be significantly impacted if PtH is successful. For PtH to be successful, attackers first must have gained local admin access on a computer that is in the organisation’s network.</p><p>As a next step, attackers will attempt to steal more authentication credentials from the already compromised computer to move laterally by reusing them for accessing other computers as well as services on the network. If the PtH is successful, it can result in compromising high-privileged accounts such as Enterprise Admins or Domain Admins. Therefore, organisations need to strengthen their security posture against PtH attacks and implement mitigation strategies to reduce the risks of such attacks <a href="#1">1</a>.</p><h2 id="attack-phases">Attack Phases</h2><p><strong>Step 1: Passing the Hash around the network</strong></p><p>We will pass the hash around the network and pawn both client machines and the domain cotroller by usingthe <code class="language-plaintext highlighter-rouge">crackmapexec smb 192.168.242.0/24 -u "dtsarouchas" -H &lt;hash_value&gt;</code> command. Even though it does not have the “<strong>Pwn3d!</strong>” note next to it, the green plus mark indicates that this account has been pawned.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/AD/Pawning_the_DC.png" alt="Pawning the DC and both user machines" /><em>Pawning the DC and both user machines</em></p><p><strong>Step 2: Gaining shell access</strong></p><p>We can gain shell access on the “<strong>MSCADMIN</strong>” computer machine using the <code class="language-plaintext highlighter-rouge">psexec.py "dtsarouchas":@192.168.242.169 - -hashes &lt;hash_value&gt;</code> command.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/AD/Gain_shell_access.png" alt="Gain shell access and control the user's machine" /><em>Gain shell access and control the user’s machine</em></p><h2 id="pass-the-password-attack-overview">Pass-the-Password Attack Overview</h2><p><strong>Pass-the-Password (PtP)</strong> attack works similarly to the PtH attack, which means that attackers have already compromised a user account. They managed to dump the NTLM hash from the SAM database of the system. They cracked it and got the user password in plain-text format. They then pass the user password along with the username to the network and try to access other computers in the network.</p><h2 id="attack-phases-1">Attack Phases</h2><p><strong>Step 1: Pass the password around the network</strong> Crackmapexec tool takes a username, domain and password and throws this password all-around against the subnet. The command used to achieve that is <code class="language-plaintext highlighter-rouge">cme smb 192.168.242.0/24 –d university.local –u dtsarouchas –p Password1</code></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/AD/Pawning_the_DC_2.png" alt="Pawning the DC and both user machines" /><em>Pawning the DC and both user machines</em></p><p>Cracmapexec attacked the domain controller “<strong>DC01</strong>”, the “<strong>John Doe</strong>” computer machine (<strong>MSCSTUDENT</strong>) and the “<strong>Dimitrios Tsarouchas</strong>” computer machine (<strong>MSCADMIN</strong>). It tried the password on the DC01, but it did not work, meaning that this user does not have SMB access to the domain controller. It pawned “<strong>jdoe</strong>” and “<strong>dtsarouchas</strong>” computer machine, and now the attacker has access to both machines.</p><p><strong>Step 2: Dumping the SAM file</strong></p><p>By typing <code class="language-plaintext highlighter-rouge">cme smb 192.168.242.0/24 -d university.local -u dtsarouchas -p Password1 -sam</code>, we are trying to dump the SAM file.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/AD/Dumping_the_SAM.png" alt="Dumping the SAM file" /><em>Dumping the SAM file</em></p><p>Cracmapexec dumped the SAM file, and we now have the “<strong>Administrator</strong>”, “<strong>Dimitrios Tsarouchas</strong>” and “<strong>John Doe</strong>” NTLM hashes.</p><p><strong>Step 3: Getting a shell on the user machine</strong></p><p>Using <code class="language-plaintext highlighter-rouge">psexec.py university/dtsarouchas:Password1@192.168.242.168</code>, we gained shell access on the “<strong>jdoe</strong>” machine (<strong>MSCSTUDENT</strong>) and we own it.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/AD/Gain_shell_access_2.png" alt="Gain shell access and control the user's machine" /><em>Gain shell access and control the user’s machine</em></p><p><strong>Step 4: Dumping hashes</strong></p><p>To dump the hashes in both user machines, we will use the <code class="language-plaintext highlighter-rouge">secretsdump.py university/dtsarouchas:Password1@192.168.242.169</code> (first figure below) and the <code class="language-plaintext highlighter-rouge">secretsdump.py university/dtsarouchas:Password1@192.168.242.169</code> (second figure) commands.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/AD/Dump_the_SAM_hashes.png" alt="Dump the SAM hashes on dtsarouchas machine" /><em>Dump the SAM hashes on dtsarouchas machine</em></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/AD/Dump_SAM_on_jdoe.png" alt="Dump the SAM hashes on jdoe machine" /><em>Dump the SAM hashes on jdoe machine</em></p><p><strong>Step 5: Cracking NTLM hashes</strong></p><p>We saved both users’ NTLM hashes and administrator NTLM hash into the “<strong>secretsdumpHases.txt</strong>” file and tried to crack them using the <code class="language-plaintext highlighter-rouge">hashcat -m 1000 secretsdumpHashes.txt rockyou.txt --force</code> command.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/AD/Crack_the_obtained_NTLM.png" alt="Crack the obtained NTLM hashes" /><em>Crack the obtained NTLM hashes</em></p><p>Hashcat managed to crack both users’ NTLM hashes and returned their passwords in a clear-text format (“<strong>Password1</strong>” and “<strong>Password2</strong>”) as shown below. <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/AD/NTLM_hashes_cracked.png" alt="NTLM hashes cracked and passwords revealed" /><em>NTLM hashes cracked and passwords revealed</em></p><h2 id="pass-the-password-and-pass-the-hash--mitigation">Pass-the-Password and Pass-the-Hash – Mitigation</h2><p>Organisations cannot wholly prevent these two attacks by simply fixing or updating their systems. For example, a change in how LSASS credentials are stored simply requires an update of the attack tools to support such modifications. The following strategies will make it difficult for attackers to access organisations’ systems. Organisations should limit administrative delegation, implement policies that prevent local passwords from being reused, restrict local administrator accounts to standard users, and apply the Least Privilege principle <a href="#1">1</a>.</p><p>Organisations should implement strong password policies, such as the use of passwords longer than fourteen characters, avoid the use of common words such as the word password, and establish policies for using long sentences with special characters instead of passwords (Passphrases).</p><p>Using Privileged Access Management (PAM) will make it even more difficult for intruders to access the organisations’ systems. Organisations can implement PAM by firstly having individual accountability to avoid everyone sharing the same account. To do that, they must use a password vault where accounts are locked away and used only on an as-needed basis. By doing this, organisations give Just-Enough-Administration to admins to do their day-to-day activities using the Least Privilege principle. Having control and watch on what these people do with their delegated rights using Session Audits.</p><p>Multi-factor authentication is needed to secure access. That proves that the person knows something more than a password.</p><p>Augmentation of controls using Identity Analytics allows the identification of wrong permissions.</p><p>Behavioural Analytics should be added for watching what the administrators do with the permissions they have been provided. The combination of Identity Analytics, Behavioural Analytics, and augmentation of controls that users get with the vault, the delegation and the session audit is more effective.</p><p>Finally, govern everything that has to do with the identity and access management is the key. Therefore, PAM is a holistic end-to-end approach that provides all the benefits to an organisation from an operational and security perspective. Mitigation of risks comes by knowing who has access to what, and what they have done with that access giving an organisation the ability to detect anomalies and achieving compliance with regulations (PCI DSS, HIPPA, SOX, FISMA) <a href="#2">2</a>, <a href="#3">3</a>, <a href="#4">4</a>.</p><h2 id="evaluation-of-mitigation-strategys-effectiveness">Evaluation of Mitigation Strategy’s Effectiveness</h2><p>Following the steps that Microsoft provides for implementing least privilege, an administrator should configure a GPO to restrict admin accounts on domain-joined computers. <a href="#5">5</a>.To do that on the domain controller use <code class="language-plaintext highlighter-rouge">Win+R</code> and run <code class="language-plaintext highlighter-rouge">secpol.msc</code>.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/AD/Open_security_policy.png" alt="Open security policy" /><em>Open security policy</em></p><p>Once the Local Security Policy window is opened, navigate to <code class="language-plaintext highlighter-rouge">Local Policies → User Right Assignments</code>. The policies that must be configured are the <code class="language-plaintext highlighter-rouge">“Deny log on through Remote Desktop Services”</code>, <code class="language-plaintext highlighter-rouge">“Deny access to this system from the network”</code>, <code class="language-plaintext highlighter-rouge">“Deny log on as a service”</code> and finally <code class="language-plaintext highlighter-rouge">“Deny log on as a batch job”</code>. By default, no user has been added to that rights.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/AD/Before_adding.png" alt="Before adding the compromised account" /><em>Before adding the compromised account</em></p><p>Administrators should add the user account “<strong>university\dtsarouchas</strong>” from these rights in order to prevent attackers who might get access to that account to pass the hash around the network and subsequently to the domain controller.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/AD/Adding_the_compromised.png" alt="Adding the compromised account" /><em>Adding the compromised account</em></p><p>After these mitigations strategies were applied on the domain controller, the attacker could not be able to Pass-the-Hash or Pass-the-Password. Now the attacker tries to Pass-the-Hash against the network “<strong>192.168.242.0/24</strong>” with a username and a hash that he hs on his hands. To do that he will use the <code class="language-plaintext highlighter-rouge">crackmapexec smb 192.168.242.0/24 -u "dtasrouchas" -H &lt;hash_value&gt;</code> command.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/AD/Logon_failure.png" alt="Logon failure on the DC and on both user machines" /><em>Logon failure on the DC and on both user machines</em></p><p>Sdaly for the attacker, Pass-the-Hass attack can not logon to the domain controller, and a “<strong>STATUS_LOGON_TYPE_NOT_GRANTED</strong>” is displayed, meaning that user “<strong>dtsarouchas</strong>” is not granted the privileges to have access to the domain controller. On top of that, Pass-the-Hash could not authenticate the user on both client machines where “<strong>dtsarouchas</strong>” is the administrator and displayed the message “<strong>STATUS_NOT_SUPPORTED</strong>”. The attacker will try to gain shell access on “<strong>dtsarouchas</strong>” computer machine. To achieve that, he uses the <code class="language-plaintext highlighter-rouge">psexec.py "dtsarouchas":@192.168.242.169 -hashes &lt;hash_value&gt;</code> command.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/AD/Cannot_create_SMB.png" alt="Cannot create SMB session" /><em>Cannot create SMB session</em></p><p>The mitigation strategies applied to the domain controller prevented the attacker from gaining shell access even though he had the hashes of the user account. The only thing that the attacker got back is an SMB session error that the request is not supported.</p><p>The same mitigation strategies apply to defend against the Pass-the-Password attack. The attacker has the password of the user “<strong>dtsarouchas</strong>”. He tries to attack against the domain controller and both domain-joined computers by using the <code class="language-plaintext highlighter-rouge">cme smb 192.168.242.0/24 -d university.local -u dtsarouchas -p Password1</code> command.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/AD/Logon_the_DC.png" alt="Logon failure on the DC and on both user machines" /><em>Logon failure on the DC and on both user machines</em></p><p>Sadly for him, he cannot compromise the domain controller and gets back a message of “<strong>STATUS_LOGON_TYPE_NOT_GRANTED</strong>” as he got previously from the failed PtH attack. He will try to dump the hashes from the SAM database but will still be unable to do it.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/AD/Logon_failure_on_the_DC.png" alt="Logon failure on the DC and on both user machines and no SAM file is dumped" /><em>Logon failure on the DC and on both user machines and no SAM file is dumped</em></p><p>Next, he will try to gain shell access on the “<strong>dtsarouchas</strong>” computer machine by using the <code class="language-plaintext highlighter-rouge">psexec.py university/dtsarouchas:Password@192.168.242.168</code> command.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/AD/Shell_access.png" alt="Shell access on the user's machine failed" /><em>Shell access on the user’s machine failed</em></p><p>Shell access cannot be gained, and an SMB session error that the request is not supported is being displayed. Then the attacker will try to dump the hashes from the SAM file on both domain-joined machines, but he will not be able to that either.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/AD/Dumping_SAM_file_failed.png" alt="Dumping the SAM file failed on both user machines" /><em>Dumping the SAM file failed on both user machines</em></p><p>He gets back the message “<strong>The request is not supported</strong>”, meaning that the mitigation strategies that were followed are effective and prevented both PtH and PtP attacks.</p><p><br /></p><p><strong>References</strong></p><p>[1]<a name="1"></a> <a href="https://download.microsoft.com/download/7/7/A/77ABC5BD-8320-41AF-863C-6ECFB10CB4B9/Mitigating-Pass-the-Hash-Attacks-and-Other-Credential-Theft-Version-2.pdf/" target="_blank">Mitigating Pass-the-Hash(PtH)Attacks and Other Credential Theft.</a></p><p>[2]<a name="2"></a> <a href="https://docs.microsoft.com/en-us/microsoft-identity-manager/pam/privileged-identity-management-for-active-directory-domain-services/" target="_blank">Privileged Access Management for Active Directory Domain Services.</a></p><p>[3]<a name="3"></a> <a href="https://www.beyondtrust.com/resources/glossary/privileged-access-management-pam/" target="_blank">Privileged Access Management (PAM).</a></p><p>[4]<a name="4"></a> <a href="https://www.cyberark.com/products/privileged-account-security-solution/core-privileged-account-security/" target="_blank">Cyberark Official Website.</a></p><p>[5]<a name="5"></a> <a href="https://docs.microsoft.com/en-us/windows-server/identity/ad-ds/plan/security-best-practices/implementing-least-privilege-administrative-models/" target="_blank">Implementing Least-Privilege Administrative Models.</a></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/windows/'>Windows</a>, <a href='/categories/active-directory/'>Active Directory</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/active-directory/" class="post-tag no-text-decoration" >active directory</a> <a href="/tags/windows/" class="post-tag no-text-decoration" >windows</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Attacking Active Directory - Pass-the-Hash / Pass-the-Password Attacks - Dimitrios Tsarouchas&url=https://dimitrios-tsarouchas.tech//posts/Active-Directory-Pass-the-Hash/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Attacking Active Directory - Pass-the-Hash / Pass-the-Password Attacks - Dimitrios Tsarouchas&u=https://dimitrios-tsarouchas.tech//posts/Active-Directory-Pass-the-Hash/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Attacking Active Directory - Pass-the-Hash / Pass-the-Password Attacks - Dimitrios Tsarouchas&url=https://dimitrios-tsarouchas.tech//posts/Active-Directory-Pass-the-Hash/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Tmux/">Tmux</a><li><a href="/posts/Active-Directory-SetUp/">Active Directory - Domain Controller Setup</a><li><a href="/posts/Goals-of-Security/">Goals of Security</a><li><a href="/posts/Threat-Actors/">Threat Actors</a><li><a href="/posts/Active-Directory-Post-Compromise-Enumeration/">Active Directory - Post-Compromise Enumeration</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/active-directory/">active directory</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/ctf/">ctf</a> <a class="post-tag" href="/tags/tryhackme/">tryhackme</a> <a class="post-tag" href="/tags/information-security/">information security</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/android/">android</a> <a class="post-tag" href="/tags/apts/">APTs</a> <a class="post-tag" href="/tags/cia-triad/">cia triad</a> <a class="post-tag" href="/tags/cve-2019-14287/">CVE-2019-14287</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Active-Directory-Authentication-Mechanisms/"><div class="card-body"> <span class="timeago small" > Aug 7, 2021 <i class="unloaded">2021-08-07T01:55:00+01:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Active Directory Authenitcation Mechanisms</h3><div class="text-muted small"><p> Windows New Technology LAN Manager vs Kerberos Authentication protocols Introduction Windows Authentication verifies that the information provided in the operating system comes from a trusted sourc...</p></div></div></a></div><div class="card"> <a href="/posts/Active-Directory-LLMNR-Poisoning/"><div class="card-body"> <span class="timeago small" > Aug 7, 2021 <i class="unloaded">2021-08-07T02:55:00+01:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Active Directory - LLMNR and NBT-NS Poisoning</h3><div class="text-muted small"><p> Attacking Active Directory Active Directory plays an essential role in a corporate domain that makes it quite attractive to attackers. The service itself does not have to be the target as it can se...</p></div></div></a></div><div class="card"> <a href="/posts/Active-Directory-SMB-Relay-Attack/"><div class="card-body"> <span class="timeago small" > Aug 10, 2021 <i class="unloaded">2021-08-10T02:55:00+01:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Attacking Active Directory - SMB Relay Attack</h3><div class="text-muted small"><p> Server Message Block Relay Attack Overview In an SMB Relay attack, an attacker instead of cracking the captured hashes offline relays those hashes to another machine on the same network. For this ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Active-Directory-Post-Compromise-Enumeration/" class="btn btn-outline-primary"><p>Active Directory - Post-Compromise Enumeration</p></a> <a href="/posts/Active-Directory-Token-Impersonation/" class="btn btn-outline-primary"><p>Attacking Active Directory - Token Impersonation Attack</p></a></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('.post-content img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/DimitriosTsaro5">Dimitrios Tsarouchas</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/active-directory/">active directory</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/ctf/">ctf</a> <a class="post-tag" href="/tags/tryhackme/">tryhackme</a> <a class="post-tag" href="/tags/information-security/">information security</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/android/">android</a> <a class="post-tag" href="/tags/apts/">APTs</a> <a class="post-tag" href="/tags/cia-triad/">cia triad</a> <a class="post-tag" href="/tags/cve-2019-14287/">CVE 2019 14287</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://dimitrios-tsarouchas.tech/{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script>
